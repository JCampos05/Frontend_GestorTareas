<div id="sidebar" [style.display]="visible ? 'block' : 'none'">
  <div class="sidebar-section">
    <h3>Vistas</h3>
    <div class="sidebar-item" (click)="cargarTodasLasTareas()">
      <i class="fas fa-th-list"></i>
      <span>Todas las tareas</span>
    </div>
    <div class="sidebar-item" (click)="cargarMiDia()">
      <i class="fas fa-sun"></i>
      <span>Mi día</span>
    </div>
    <div class="sidebar-item" (click)="filtrarPorEstado('P')">
      <i class="far fa-clock"></i>
      <span>Pendientes</span>
    </div>
    <div class="sidebar-item" (click)="filtrarPorEstado('N')">
      <i class="fas fa-spinner"></i>
      <span>En progreso</span>
    </div>
    <div class="sidebar-item" (click)="filtrarPorEstado('C')">
      <i class="fas fa-check-circle"></i>
      <span>Completadas</span>
    </div>
    <div class="sidebar-item" (click)="cargarTareasVencidas()">
      <i class="fas fa-exclamation-triangle"></i>
      <span>Vencidas</span>
    </div>
  </div>

  <div class="sidebar-section">
    <h3>Tools</h3>
    <div class="sidebar-item" (click)="mostrarListasIndividuales()">
      <i class="fas fa-list"></i>
      <span>Listas individuales</span>
    </div>
    <div class="sidebar-item" (click)="mostrarListasImportantes()">
      <i class="fas fa-star"></i>
      <span>Listas importantes</span>
    </div>
    <div class="sidebar-item" (click)="mostrarCalendario()">
      <i class="far fa-calendar-alt"></i>
      <span>Calendario</span>
    </div>
    <div class="sidebar-item" (click)="mostrarImportante()">
      <i class="fas fa-exclamation-circle"></i>
      <span>Importante</span>
    </div>
    <div class="sidebar-item" (click)="mostrarNotas()">
      <i class="far fa-sticky-note"></i>
      <span>Notas</span>
    </div>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-header">
      <h3>Categorías / Grupos </h3>
      <button class="btn-add-categoria" (click)="abrirModalCategoria()" title="Agregar categoría">
        <i class="fas fa-plus"></i>
      </button>
    </div>

    <div id="sidebarCategorias">
      <!-- Categorías con sus listas -->
      <div *ngFor="let categoria of categorias" class="sidebar-categoria">
        <div class="sidebar-categoria-header" (click)="toggleCategoria(categoria.idCategoria)">
          <span>
            <i class="fas"
              [ngClass]="isCategoriaExpandida(categoria.idCategoria) ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
            {{ categoria.nombre }}
          </span>
          <div class="categoria-actions">
            <button class="btn-add-lista" (click)="abrirModalLista(categoria.idCategoria, $event)"
              title="Agregar lista">
              <i class="fas fa-plus"></i>
            </button>
            <button class="btn-delete-categoria" (click)="confirmarEliminarCategoria(categoria, $event)"
              title="Eliminar categoría">
              <i class="fas fa-trash"></i>
            </button>
            <span class="count">{{ categoria.listas?.length || 0 }}</span>
          </div>
        </div>
        <div class="sidebar-listas" [style.display]="isCategoriaExpandida(categoria.idCategoria) ? 'block' : 'none'">
          <div *ngFor="let lista of categoria.listas" class="sidebar-lista-item"
            (click)="cargarTareasDeLista(lista.idLista)">
            <!-- Emoji sin fondo -->
            <span *ngIf="esEmoji(lista.icono)" class="emoji-icon">{{ lista.icono }}</span>
            <!-- Icono Font Awesome con fondo de color -->
            <span *ngIf="!esEmoji(lista.icono)" class="lista-icon-wrapper"
              [style.background-color]="lista.color || '#6554c0'">
              <i [class]="obtenerClaseIcono(lista.icono)" class="icon-sidebar"></i>
            </span>
            <span>{{ lista.nombre }}</span>
          </div>
        </div>
      </div>

      <!-- Separador antes de las listas sin categoría -->
      <div class="sidebar-separator"></div>

      <!-- Botón para agregar lista sin categoría -->
      <div class="agregar-lista-sin-categoria">
        <button class="btn-agregar-lista-suelta" (click)="abrirModalListaSinCategoria()">
          <i class="fas fa-plus"></i>
          <span>Agregar lista sin categoría</span>
        </button>
      </div>

      <!-- Listas sin categoría -->
      <div *ngFor="let lista of listasSinCategoria" class="sidebar-lista-suelta"
        (click)="cargarTareasDeLista(lista.idLista)">
        <!-- Emoji sin fondo -->
        <span *ngIf="esEmoji(lista.icono)" class="emoji-icon">{{ lista.icono }}</span>
        <!-- Icono Font Awesome con fondo de color -->
        <span *ngIf="!esEmoji(lista.icono)" class="lista-icon-wrapper"
          [style.background-color]="lista.color || '#6554c0'">
          <i [class]="obtenerClaseIcono(lista.icono)" class="icon-sidebar"></i>
        </span>
        <span>{{ lista.nombre }}</span>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmación de eliminación de categoría -->
<div *ngIf="categoriaAEliminar" class="modal-overlay categoria-modal" (click)="cancelarEliminarCategoria()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-exclamation-triangle"></i> Confirmar eliminación</h3>
    </div>
    <div class="modal-body">
      <p>¿Estás seguro que deseas eliminar la lista <strong>"{{ categoriaAEliminar.nombre }}"</strong>?</p>
      <p class="advertencia">Esta acción también eliminará todas las tareas asociadas y no se puede deshacer.</p>
    </div>
    <div class="modal-footer">
      <button (click)="cancelarEliminarCategoria()" class="btn-cancelar">
        <i class="fas fa-times"></i> Cancelar
      </button>
      <button (click)="eliminarCategoria()" class="btn-confirmar-eliminar">
        <i class="fas fa-trash"></i> Eliminar
      </button>
    </div>
  </div>
</div>