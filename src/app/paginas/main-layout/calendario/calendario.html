<div class="calendario-container">
    <!-- Header -->
    <div class="calendario-header">
        <div class="navegacion">
            <button class="btn-nav" (click)="mesAnterior()">
                <span>←</span>
            </button>
            <h2 class="mes-anio">{{ mesAnio }}</h2>
            <button class="btn-nav" (click)="mesSiguiente()">
                <span>→</span>
            </button>
        </div>
        <button class="btn-crear" (click)="crearTarea()">
            + Nueva Tarea
        </button>
    </div>

    <!-- Días de la semana -->
    <div class="dias-semana">
        <div class="dia-semana" *ngFor="let dia of diasSemana">
            {{ dia }}
        </div>
    </div>

    <!-- Grilla del calendario -->
    <div class="grilla-calendario">
        <div class="celda-dia" *ngFor="let dia of diasCalendario" 
            [class.otro-mes]="!dia.esDelMes"
            [class.hoy]="esHoy(dia.fecha)" 
            [class.seleccionado]="diaSeleccionado?.fecha === dia.fecha"
            (click)="seleccionarDia(dia)">
            <div class="numero-dia">{{ dia.numero }}</div>

            <div class="tareas-dia">
                <div class="tarea-item" *ngFor="let tarea of dia.tareas.slice(0, 3)"
                    [class]="getPrioridadClass(tarea.prioridad)" 
                    [class.completada]="tarea.estado === 'C'">
                    <span class="tarea-nombre">{{ tarea.nombre }}</span>
                </div>
                <div class="mas-tareas" *ngIf="dia.tareas.length > 3">
                    +{{ dia.tareas.length - 3 }} más
                </div>
            </div>
        </div>
    </div>

    <!-- Panel lateral de tareas del día -->
    <div class="panel-dia" *ngIf="diaSeleccionado">
        <div class="panel-header">
            <h3>
                {{ diaSeleccionado.fecha | date: 'EEEE, d MMMM' }}
            </h3>
            <button class="btn-cerrar" (click)="cerrarPanel()">×</button>
        </div>

        <div class="panel-content">
            <div *ngIf="diaSeleccionado.tareas.length === 0" class="sin-tareas">
                No hay tareas para este día
            </div>

            <div class="lista-tareas-dia">
                <div class="tarea-completa" *ngFor="let tarea of diaSeleccionado.tareas"
                    [class.completada]="tarea.estado === 'C'">
                    <div class="tarea-check">
                        <input type="checkbox" [checked]="tarea.estado === 'C'" 
                            (change)="cambiarEstadoTarea(tarea)">
                    </div>

                    <div class="tarea-info">
                        <div class="tarea-titulo">
                            {{ tarea.nombre }}
                        </div>
                        <div class="tarea-detalles">
                            <span class="tarea-lista" *ngIf="tarea.nombreLista">
                                <span *ngIf="esEmoji(tarea.iconoLista)" class="lista-emoji">
                                    {{ tarea.iconoLista }}
                                </span>
                                <i *ngIf="!esEmoji(tarea.iconoLista)" [class]="obtenerClaseIcono(tarea.iconoLista)"></i>
                                {{ tarea.nombreLista }}
                            </span>
                            <span [class]="'badge ' + getPrioridadClass(tarea.prioridad)">
                                {{ tarea.prioridad === 'A' ? 'Alta' : tarea.prioridad === 'B' ? 'Baja' : 'Normal' }}
                            </span>
                            <span class="tarea-vencimiento" *ngIf="tarea.fechaVencimiento">
                                <i class="far fa-calendar-alt"></i> Vence: {{ tarea.fechaVencimiento | date: 'short' }}
                            </span>
                        </div>
                        <div class="tarea-descripcion" *ngIf="tarea.descripcion">
                            {{ tarea.descripcion }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Panel de creación de tarea -->
<app-panel-detalles
    [abierto]="panelCrearAbierto"
    (cerrar)="cerrarPanelCrear()"
    (tareaGuardada)="onTareaCreada()">
</app-panel-detalles>