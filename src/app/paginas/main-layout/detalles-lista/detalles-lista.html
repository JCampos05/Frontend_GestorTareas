<div class="detalle-lista-container">
    <div class="lista-header" *ngIf="nombreLista">
        <div class="header-top">
            <h2>
                <span class="lista-icono" [style.background-color]="colorLista">
                    <span *ngIf="esEmoji(iconoLista)">{{ iconoLista }}</span>
                    <i *ngIf="!esEmoji(iconoLista)" [class]="obtenerClaseIcono(iconoLista)"></i>
                </span>
                {{ nombreLista }}
            </h2>

            <!-- ✅ SIEMPRE mostrar acciones si eres propietario o admin -->
            <div class="header-actions" *ngIf="esPropietario || esAdmin">
                <!-- Usuarios compartidos (solo si hay) -->
                <div class="usuarios-avatares" *ngIf="usuariosCompartidos.length > 0">
                    <div *ngFor="let usuario of usuariosCompartidos.slice(0, 5)" class="avatar"
                        [title]="usuario.nombre + ' (' + usuario.rol + ')'">
                        {{ obtenerIniciales(usuario.nombre) }}
                    </div>
                    <div class="avatar-mas" *ngIf="usuariosCompartidos.length > 5">
                        +{{ usuariosCompartidos.length - 5 }}
                    </div>
                </div>

                <button *ngIf="puedeAsignarTareas()" class="btn-asignar-tareas" (click)="abrirModalAsignar()"
                    title="Asignar tareas a usuarios">
                    <i class="fas fa-user-check"></i>
                    Asignar tareas
                </button>


                <!-- ✅ Botón SIEMPRE visible para propietarios/admins -->
                <button class="btn-gestionar-usuarios" (click)="abrirModalUsuarios()">
                    <i class="fas fa-cog"></i>
                    Gestionar usuarios
                </button>
            </div>
        </div>

        <p *ngIf="descripcionLista" class="lista-descripcion">{{ descripcionLista }}</p>
        <div *ngIf="!puedeEditarTareas()" class="alert-solo-lectura">
            <i class="fas fa-eye"></i>
            <span>Estás viendo esta lista en modo de <strong>solo lectura</strong></span>
        </div>
    </div>

<app-columnas 
  [puedeEditar]="puedeEditarTareas()" 
  [puedeEliminar]="puedeEliminarTareas()"
  [puedeAsignar]="puedeAsignarTareas()"
  (abrirModalAsignar)="abrirModalAsignarTarea($event)">  <!-- ✅ ESTA LÍNEA ES CRÍTICA -->
</app-columnas>
    <!-- Modal de gestión de usuarios -->
    <app-modal-usuarios-lista [isOpen]="modalUsuariosAbierto" [listaId]="idLista" [esPropietario]="esPropietario"
        [esAdmin]="esAdmin" (close)="cerrarModalUsuarios()" (actualizado)="onUsuariosActualizados()">
    </app-modal-usuarios-lista>
<app-modal-asignar-tarea 
    [isOpen]="modalAsignarAbierto" 
    [tarea]="tareaSeleccionada" 
    [idLista]="idLista"
    (close)="cerrarModalAsignar()" 
    (asignado)="onTareaAsignada()">
</app-modal-asignar-tarea>
</div>